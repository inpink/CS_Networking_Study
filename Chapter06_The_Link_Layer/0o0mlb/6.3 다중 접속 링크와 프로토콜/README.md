# 6.3 다중 접속 링크와 프로토콜
네트워크 링크에는 두 종류가 있다
- `점대점 링크` : 링크의 한쪽 끝에 한 송신자와 링크의 다른 쪽 끝에 한 수신자가 있다. ex) PPP, HDLC
- `브로드캐스트 링크` : 동일한 하나의 공유된 브로드캐스트 채널에 다수의 송신 노드 및 수신 노드가 연결된다. ( **브로드캐스트** : 임의의 한 노드가 프레임을 전송하면 채널이 그 프레임을 브로드캐스트해서 다른 모든 노드가 그 프레임의 복사본을 수신함 ). ex) 이더넷, 무선 랜

`다중 접속 문제` : 다수의 송수신 노드들의 공유되는 브로드캐스트 채널로의 접속을 조정하는 문제

`다중 접속 프로토콜` : 컴퓨터 네트워크에서 공유되는 브로드캐스트 채널로 보내는 노드들의 전송을 조정하는 프로토콜. **채널 분할/랜덤 접속/순번 프로토콜**로 분류할 수 있다

`충돌` : 2개 이상의 노드가 동시에 프레임을 전송하면 전송된 프레임들이 각 수신자에서 충돌한다

## 6.3.1 채널 분할 프로토콜
1. `TDM 시분할 다중화` : 시간을 **시간 프레임**으로 나누고 각 시간 프렝밍르 N개의 **시간 슬롯**으로 나눈다
- 단점 1. 전송할 패킷이 있는 노드가 단 하나인 경우에도 노드 전송률이 평균 R/N으로 제한된다
- 단점 2. 노드가 전송 순서상 자신의 차례를 항상 기다려야 한다

2. `FDM 주파수 분할 다중화` : R bps의 채널을 다른 주파수로 나눠서 각 주파수를 N개 노드 중 하나에게 할당한다. TDM과 같은 장단점을 갖는다

3. `CDMA 코드 분할 다중 접속` : **다른 코드**를 각 노드에게 할당하고 노드는 전송하는 데이터 비트들을 자신의 유일한 코드로 인코딩한다
- 장점 1. 여러 노드들이 **동시에** 전송할 수 있다
- 장점 2. 다른 노드들에 의해 전송이 간섭되더라도 각 수신자들이 송신자의 인코딩된 데이터 비트를 정확하게 수신할 수 있다

---
## 6.3.2 랜덤 접속 프로토콜
랜덤 접속 프로토콜에서 전송 노드는 항상 채널의 최대 전송률인 R bps로 전송한다

충돌이 생기면 충돌과 관련된 각 노드는 프레임이 충돌 없이 전송될 때까지 자신의 프레임을 계속해서 재전송한다. **프레임을 재전송하기 전에, 랜덤 지연 시간 동안 기다린다**

### 슬롯 알로하
슬롯 알로하는 다음과 같다
- 모든 프레임은 정확히 `L비트`로 구성되며 시간은 `L/R초`의 슬롯들로 나뉜다
- 노드는 슬롯의 시작점에서만 프레임을 전송하기 시작하며, 각 노드는 언제 슬롯이 시작하는지 알 수 있게끔 동기화되어 있다
- 한 슬롯에서 2개 이상의 프레임이 충돌하면, 모든 노드는 그 슬롯이 끝나기 전에 충돌 발생을 알게 된다

슬롯 알로하의 장점은 다음과 같다
- 하나의 활성 노드(전송할 프레임이 있는 노드)를 채널의 전속력 R로 계속해서 프레임을 전송할 수 있도록 허용한다
- 각 노드가 충돌을 감지하고 언제 재전송할지 각자 결정하므로 상당히 분산되어 있다

단점은 다음과 같다
- 활성 노드가 많이 있으면, 일부 슬롯이 충돌로 인해 `낭비`가 된다
- 모든 활성 노드가 확률적인 전송 정책 때문에 전송을 억제하는 경우 일부 슬롯이 빈다

### 알로하
순수 알로하인 프로토콜은 프레임이 도착하면 노드는 즉시 그 프레임 전체를 브로드캐스트 채널로 전송한다

프레임이 하나 이상의 다른 전송과 충돌하면, 노드는 확률 p로 그 프레임을 즉시 재전송한다. 

즉시 재전송하지 않는 경우, 노드는 프레임 전송 시간 동안 기다린다

### CSMA
중요한 두 가지 규칙

1. 말하기 전에 듣는다 = `캐리어 감지` : 다른 노드가 프레임을 채널로 전송하고 있을 경우, 노드는 임의의 짧은 시간 동안 전송 중단을 감지하면 프레임을 전송하기 시작한다

2. 다른 사람이 동시에 말하기 시작하면 말을 중단한다 = `충돌 검출` : 다른 노드가 방해 프레임을 전송하고 있음을 검출하면, 자신의 전송을 중단하고 랜덤 시간 동안 기다린 후, 유휴 시 감지 및 전송 과정을 반복한다

브로드캐스트 채널 종단 간의 **채널 전파 지연**이 CSMA의 성능을 결정하는데 중요한 역할을 한다. 전파 지연이 길수록, 네트워크의 다른 노드에서 이미 시작된 전송을 캐리어 감지 노드가 감지할 수 없는 경우 더 증가한다

### CSMA/CD
노드가 충돌 검출을 수행하면, 충돌이 검출되었을 때 **바로 자신의 전송을 중단한다**

이때, 고정 시간이 아닌 **랜덤 시간**을 기다리는데, 충돌하는 노드가 적을 때는 시간 간격을 작게 하고, 충돌하는 노드가 많을 때는 시간 간격을 크게 할 필요가 있다.

`이진 지수적 백오프`는 프레임이 충돌을 더 많이 경험할수록 **K를 선택할 간격**을 크게 하여 노드가 실제 기다리는 시간은 K * 512 비트 시간이 된다.

---
## 6.3.3 순번 프로토콜
순번 프로토콜은 'M개의 노드가 활성이면 각 노드가 거의 R/M bps의 처리율을 갖는다'의 특성을 가지며 두 개의 중요한 프로토콜이 있다

1. `폴링 프로토콜` : 노드 중 하나를 **마스터 노드**로 지정한다. 마스터 노드는 각 노드를 라운드 로빈 방식으로 **폴링** 한다
- 빈 슬롯을 제거함으로써 훨씬 높은 효율을 제공한다
- 폴링 지연, 즉 노드가 전송할 수 있음을 알리는 데 걸리는 시간이 있다
- 마스터 노드가 고장 나면 전체 채널이 동작하지 못하게 된다

2. `토큰 전달 프로토콜` : **토큰** 이라는 작은 특수 목적 프레임이 정해진 순서대로 노드 간에 전달된다
- 토큰 전달은 분산 방식이며 효율이 매우 높다
- 노드 하나가 실패하면 전체 채널이 동작하지 않는다
- 노드가 잘못해서 토큰을 놓아주지 않으면, 토큰이 다시 돌 수 있도록 하는 회복 절차가 실행되어야만 한다

---
## 6.3.4 DOCSIS: 케이블 인터넷 접속을 위한 링크 계층 프로토콜
> `DOCSIS`는 케이블 데이터 네트워크의 구조와 프로토콜들을 정의한다

- 하향 및 상향 네트워크 세그먼트들을 다수의 주파수 채널로 나누기 위해 FDM을 사용한다
- CMTS에 의해 하향 채널로 전송된 프레임은 그 채널을 통해 수신하는 모든 케이블 모뎀에 의해 수신된다
- 상향의 경우 다수의 케이블 모뎀이 CMTS로의 동일한 상향 채널(주파수)을 공유하고 충돌이 발생할 수 있다
- 케이블 모뎀이 특정 미니슬롯들을 사용해서 미니슬롯 요청 프레임을 CMTS에 전송함으로써 어떤 케이블 모뎀이 전송할 데이터인지 알게 된다
- 충돌이 발생한 것으로 추정된 케이블 모뎀은 미니슬롯 요청 프레임의 재전송을 지연시키기 위해 이진 지수적 백오프를 사용한다
- 상향 채널에 트래픽이 거의 없는 경우, 케이블 모뎀은 미니슬롯 요청 프레임을 위해 할당된 슬롯에 데이터 프레임을 전송할 수도 있다
