# 5.6 인터넷 제어 메시지 프로토콜(ICMP)
> 인터넷 제어 메시지 프로토콜은 호스트와 라우터가 서로 간에 네트워크 계층 정보를 주고받기 위해 사용한다

ICMP는 종종 IP의 한 부분으로 간주되지만, ICMP 메시지가 IP 데이터그램에 담겨 전송되므로 **구조적으로 IP 바로 위에 있다**

즉, ICMP 메시지도 **IP 페이로드로 전송되며,** 호스트가 상위 계층 프로토콜이 ICMP로 표시된 IP 데이터그램을 받으면 ICMP로 내용을 역다중화한다

ICMP 메시지는 `타입과 코드 필드`가 있고, ICMP 메시지의 발생 원인이 된 IP 데이터그램의 헤더와 첫 8바이트를 갖는다. 이는 송신자가 오류를 발생시킨 패킷을 알 수 있도록 하기 위해서이다


**ping 프로그램**

1. `타입 8, 코드 0인 ICMP 메시지`를 특정 호스트에 보낸다
2. 목적지 호스트는 에코 요청을 보고 나서 `타입 0, 코드 0인 ICMP 에코 응답`을 보낸다


**출발지 억제 메시지**

이 메시지는 혼잡 제어를 수행하기 위한 것이다.
즉, **혼잡이 발생한 라우터가 호스트의 전송 속도를 늦추도록** `ICMP 출발지 억제 메시지`를 해당 호스트에 보낸다


**Traceroute 프로그램**

1. **출발지와 목적지 사이의 라우터 이름과 주소를 알아내기 위해**, 출발지의 Traceroute는 일련의 `IP 데이터그램`을 목적지에 보낸다. 각각의 데이터그램은 UDP 포트 번호를 가진 UDP 세그먼트를 운반한다
2. 출발지는 각 데이터그램에 대해 타이머를 작동시킨다
3. IP 프로토콜 규칙에 따라 라우터는 데이터그램을 폐기하고 `ICMP 경고 메시지(타입 11, 코드 0)`를 출발지에 보낸다
4. 이 ICMP 메시지가 출발지에 도착하면, 출발지는 (1) 타이머로부터 왕복시간 (2) ICMP 메시지로부터 n번째 라우터의 주소와 이름을 획득한다
