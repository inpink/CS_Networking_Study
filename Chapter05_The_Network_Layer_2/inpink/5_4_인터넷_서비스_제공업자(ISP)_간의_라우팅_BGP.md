> 목차

👉[5.4 인터넷 서비스 제공업자(ISP) 간의 라우팅: BGP](#54-인터넷-서비스-제공업자ISP-간의-라우팅-BGP)　   
　   [5.4.1 BGP의 역할](#541-BGP의-역할)　   　   
　   [5.4.2 BGP 경로 정보 알리기](#542-BGP-경로-정보-알리기)　   
　   [5.4.3 최고의 경로 결정](#543-최고의-경로-결정)　　   　    
　   [5.4.4 뜨거운 감자 라우팅(hot potato routing)](#544-뜨거운-감자-라우팅hot-potato-routing)　   　   
    
　   
　   

## 5.4 인터넷 서비스 제공업자(ISP) 간의 라우팅: BGP

OSPF는 AS 내부에서 사용하는 라우팅 프로토콜이었다.　   
BGP는 **AS간의 라우팅 프로토콜**이다.　   
BGP는 인터넷의 대부분의 AS들이 사용한다. 　   
인터넷의 수천 개의 ISP들을 연결해주기 때문에, IP만큼이나 중요한 프로토콜이다.　   
DV(벨만포드) 라우팅 알고리즘을 사용한다. (분산형 비동기식 프로토콜)　   
　   
BGP에서는 패킷이 **주소 프리픽스(prefix)**으로 전달된다. (**CIDR 형식 사용**)　   
어떤 기관의 a.b.c/x 형태의 대표 주소 프리픽스로 전달된다는 것이다. (4장 IPv4에서 학습)　   
따라서 라우터의 포워딩 테이블은 (x,I)같은 형식의 엔트리를 가지게 된다.　   
x는 주소 프리픽스고, I는 라우터 인터페이스의 인터페이스 번호라고 배웠다.　   
　   
　   
### 5.4.1 BGP의 역할

1. 이웃 AS를 통해 도달 가능한 서브넷 프리픽스 정보를 얻는다.　   
   **어떤 서브넷이 본인의 정보를 다른 라우터에게 알리기 위해, BGP를 이용한다**　   
   BGP가 없다면, **각 서브넷들은 고립된 섬**처럼, 알려지지 않고, 인터넷에서 접근 불가한 지역이 된다.　   
   　   
2. 라우터는 서브넷 주소 프리픽스로 가기 위해, 가장 좋은 경로를 선택할 수 있다.　   
   다양한 정책에 기반하여 좋은 경로를 선택한다.　   
　   
　   
### 5.4.2 BGP 경로 정보 알리기

![image](https://github.com/inpink/CS_Networking_Study/assets/108166692/93c59a7c-1562-4e18-bd93-74515e20b5ff)　   
위 그림은 3개의 자율시스템(AS1, AS2, AS3)를 나타내고 있다.　   
빨간 색 부분은 **게이트웨이 라우터**이다. 이는 AS의 경계에 있는 라우터로, 다른 AS에 있는 라우터와 직접 연결된다.　    
　   
x는 프리픽스이다. 프리픽스 x에 대해 도달 가능한 정보를 얻는 과정은 다음과 같다. 　   
1. AS3가 AS2에게 BGP 메세지를 보내, x가 AS3 내에 존재한다고 알린다.　   
2. AS2는 AS1에게 BGP 메세지를 보내, x가 존재하고, AS2를 거쳐 x로 갈 수 있다고 알린다.　   
　   　   
파란색 부분은 **내부 라우터**이다.　   
TCP 연결을 통해 BGP 메세지가 전송되는데,　   
내부 라우터끼리 **BGP 연결**된 것을 **내부 BGP(iBGP)**라고 하며,　   
AS간 BGP 연결은 **외부 BGP(eBGP)**라고 한다.　   
　   
　   
### 5.4.3 최고의 경로 결정

라우터에서 목적지 서브넷까지는 여러 개의 경로가 있을 수 있다.　   
**최고의 경로**를 어떻게 선택할까? 그리고 이 과정에서 **포워딩 테이블**을 어떻게 설정할까?　   
　   
위에 대한 대답을 하기 전, 우선 BGP와 관련된 몇 가지 용어를 익혀야 한다.　   

　   
> BGP 경로(route)

BGP 경로는 프리픽스와, BGP 속성들을 말한다.　　   
　   
　   
> BGP 속성들

BGP 속성 중 중요한 두 가지가 AS-PATH와 NEXT-HOP이다.　 　      　
AS-PATH는 AS들을 담은 리스트이다. 경로를 선택할 때 사용하며, 메시지의 루프를 감지하고 방지하는 역할도 한다. 　　　      
NEXT-HOP은 AS-PATH가 시작되는 라우터 인터페이스의 IP 주소이다. 363p의 그림 5.10을 참고하자. 포워딩 테이블을 형성할 때 NEXT-HOP을 이용한다.　　   　   
　   
    　   
> IP 애니캐스트

BGP는 DNS에서 흔히 사용되는 **IP 애니캐스트 서비스**를 구현하는데도 사용된다.　   
1) 지리적으로 분산된 다른 많은 서버에 **같은 콘텐츠**가 복사되어 있을 때,　   　   
2) 특정 지역에서 사용자가 이 컨텐츠에 접근하려고 할 때, 가장 가까운 서버의 콘텐츠를 쓰는 것이 가장 효율적이다.　   
   BGP의 경로 선택 알고리즘은, 복제된 이 콘텐츠를 가진 가장 가까운 서버를 알려주고 선택할 수 있는 효율적인 방법이다.　   
　   
　   
　   
　   
### 5.4.4 뜨거운 감자 라우팅(hot potato routing)

BGP, OSPF를 사용하는 알고리즘이다.　   
　   
1) 라우터는, **여러 게이트웨이를 통해 서브넷 x에 도달할 수 있다**는 사실을 BGP(AS간 프로토콜)를 통해 알게된다.　   
   　   
2) OSPF(AS 내부 프로토콜)를 이용하여, **각 게이트웨이까지의 최소 비용 경로**를 결정한다　   
   　   
3) 뜨거운 감자 라우팅 : 자신의 외부 AS의 상황은 고려하지 않고, 최대한 적은 비용으로 빨리 패킷을 자신의 AS 밖으로 내보내는 알고리즘이다.　   
   최대한 적은 비용으로 나갈 수 있는 게이트웨이를 찾아 나가는 것이다.　   
   예를 들어 AS1 내부에서 게이트웨이가 a1, a3 두개이고, 현재 a2 내부 라우터라고 하자.　   
   a2->a1 :100　   
   a2->a3 :150　   
   일 때, a3을 선택하는 게 목적지 x에 대해 더 빠르게 도착할지라도, 이 자체를 고려조차 하지 않고　   
   최소 비용으로 내보낼 수 있는 a1 게이트웨이를 선택해서 내보내는 것이다.　   
   　   
   오로지 자신 AS 내부의 비용을 줄이는 것에 관심이 있는 이기적인 알고리즘이다. 　   
   (감자가 너무 뜨겁기 때문에 손 안에 두지 않고 빠르게 외부로 넘겨버리는 것)　   
　   
4) 포워딩 테이블에서 **최소 비용 게이트웨이**의 인터페이스 I를 결정하고, 포워딩 테이블에 (x,I)를 추가한다.　   


