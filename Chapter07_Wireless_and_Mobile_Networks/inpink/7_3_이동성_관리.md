> 목차

👉[7.3 이동성 관리](#72-와이파이-80211-무선-랜)　   
　   [7.3.1 장치 이동성: 네트워크 계층의 관점](#731-장치-이동성-네트워크-계층의-관점)　   　   
　   
　   
## 7.3 이동성 관리

> 무선 이동 네트워크와 관련된 용어 정리

1. HSS(Home Subscriber Service) : **모든 셀룰러 사용자는 자신이 가입한 통신 사업자라는 "집"이 있다.**　   
   가입자 정보, 통신 암호화 키, 요금 정보 등을 담고 있다.　   　   
2. IMSI(International Mobile Subscriber Identity) : 단말기와 가입 ISP 등의 정보를 암호화한 "단말기 고유 식별자"　   
3. IMEI(International Mobile station Equipment Identity) : 단말기의 MAC 주소를 암호화한 "단말기 고유 번호"　   
4. MME(Mobility Management Entity) : HSS와 함께 네트워크에 접속하려는 장치들을 인증하기 위해 데이터의 경로 역할을 하고, 필요한 정보(이동 장치의 셀 위치 등)을 저장한다.　   
　   
　   
　   
### 7.3.1 장치 이동성: 네트워크 계층의 관점

무선 링크 덕분에 우리는 이동하며 네트워크에 접속할 수 있다.　   
**이동성**을 얻은 것이다.　   
　   
이동 장치는 TCP같은 상위 레벨의 연결은 유지하고, IP 데이터그램을 계속 보내고 받는 상태에서, 시간에 따라 이동하며 **네트워크로의 접속점을 변경한다**　   
이 때, **핸드오버(handover)**를 이용한다.　   
만약 **단일 네트워크 사업자 내에** 속한 네트워크 사이에서만 핸드오버를 한다면, 해당 사업자는 자체적으로 핸드오버를 처리할 수 있기 때문에, 비교적 덜 복잡하게 핸드오버를 할 수 있다.　   
하지만 여러 네트워크 사업자 사이를 로밍하는 경우, 사업자들이 서로 협력해서 이를 처리해야 하므로 복잡해진다. 　   
　   
> 핸드 오버

하나의 기지국(AP)에서 다른 기지국으로 데이터그램을 책임지고 전달하는 방법, 과정을 의미한다.　   
핸드 오버에는 다양한 상황에 따른 다양한 방법이 있다. 그 중 하나를 소개하겠다.　   
　   
1. 이동 장치가 속한 BSS가 변했고, 출발지 기지국(AP1)이 목적지 기지국(AP2)으로 이동 호스트를 넘기기로 했다.　   
2. AP1은 AP2를 선택하고, **핸드 오버 요청 메세지**를 보낸다.　   
3. AP2는 이동 호스트를 받기에 충분한 자원이 있는지 확인한다. 필요한 채널 자원(시간 슬롯 등)을 미리 할당하고, **요청 승인 메세지**를 보낸다.　   
   이 때, **이동 장치가 새로운 기지국 AP2와 결합하는 데 필요한 모든 정보를 같이 보내준다.**　   
4. AP1은 이동 호스트에게 받은 AP2의 정보를 보내준다. 이 시점에서, **이동 장치는 핸드 오버가 완료된 것이라고 인식할 수 있다. ★호스트는 새로운 기지국 AP2로 데이터를 전송할 수 있다.★**　   
5. 하지만, 네트워크 입장에서는 아직 할 일이 더 있다.　   
   ⓐ AP1은 아직 호스트에게 다 전송하지 못한 데이터그램을 AP2로 전송한다. (AP1가 다운받아서 데이터를 가지고 있으니까)　   
   ⓑ AP2는 MME에게 자신이 이동 장치를 서비스하는 새로운 기지국임을 알린다.　   
   ⓒ MME는 S-GW(서빙 게이트웨이)와 AP2에 신호를 보내, AP1<->S-GW를 AP2<->S-GW로 연결할 수 있도록 한다.　   
   ⓓ AP2는 터널이 잘 생성되었음을 알려서, AP1이 이전 이동 장치와 관련된 연결을 끊을 수 있도록 한다.　   
   ⓔ AP2는 이동 호스트에게 데이터그램 전송을 시작한다. **새롭게 AP2에 도착하는 데이터그램 + 핸드오버 기간 중 ⓐ에서 받은 데이터그램**을 전송한다.　   
   또, 이동 장치가 송신하는 데이터그램을 AP2가 받아 터널을 타고 S-GW로 보내준다.　   
   　   
　   
=>535p 그림 7.30을 참고하자. 그림을 봐야 이해가 된다.　   
　   
　   
　   
> 이동 장치로의 간접 라우팅

1. 송신자는 데이터그램을 이동 호스트의 영구 주소(이동 호스트의 홈 네트워크)로 보낸다. 송신자는 호스트가 이동 중인지, 어디있는지 전혀 알지 못한다. 홈 네트워크로 보낼뿐이다.　   
2. **홈 네트워크 게이트웨이**는 이 데이터그램을 가로챈다. **HSS와 상의하여 현재 이동장치가 있는 방문 네트워크를 결정한다.**　   
   그리고 그 **방문 네트워크의 게이트웨이 라우터로** 데이터그램을 전송한다.　   
3. NAT 변환(네트워크 내부에 호스트가 사설 ip를 사용하고 있을 경우)이 필요할 경우,　   
   ⓐ 호스트는 직접 송신자에게 "공인 ip의 사설 ip는 ~~입니다."라고 알릴 수 있다.　   
   ⓑ 홈 네트워크 게이트웨이를 통해서 알릴 수도 있다.　   
　   
=> 529p 그림 7.26를 참고하자.　   
　   
　   
> 이동 장치로의 직접 라우팅

위의 간접 라우팅 방식은 비효율적인 부분이 있다. 반드시 홈 네트워크를 거쳐야 하기 때문에, 경로가 비효율적일 수 있다.　   
**직접 라우팅**방식은 이 문제를 해결할 수 있지만, 이 또한 추가적인 문제를 가질 수도 있다.　   
　   
1. 송신자는 데이터그램을 이동 호스트의 영구 주소(이동 호스트의 홈 네트워크)로 보낸다. 　   
2. **홈 네트워크 게이트웨이**는 HSS등과 상의하여 **현재 이동 호스트가 속한 네트워크 정보를 송신자에게 응답한다**　   
3. 송신자는 전달받은 정보의 **방문 네트워크**에 직접 전달한다.　   
　   
만약 응답을 받은 다음에 이동 호스트가 속한 방문 네트워크가 변경되면, 전달이 안되는 것이다.　   
이를 추가로 해결하는 로직을 짜줘야 한다는 문제가 있다.　   
