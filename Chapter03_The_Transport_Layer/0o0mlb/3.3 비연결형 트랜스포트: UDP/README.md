# 3.3 비연결형 트랜스포트: UDP
UDP는 `다중화/역다중화` 기능과 간단한 `오류 검사` 기능만을 제공한다

UDP는 애플리케이션 프로세스로부터 메시지를 가져와서 `다중화/역다중화` 서비스에 대한 `출발지 포트 번호` 필드와 `목적지 포트 번호` 필드를 첨부하고 다른 두 필드를 추가한 후에 최종 세그먼트를 네트워크 계층으로 넘겨준다

UDP는 세그먼트를 송신하기 전에 핸드셰이크를 사용하지 않기에 **비연결형**이라고 한다

`DNS`가 전형적으로 UDP를 사용하는 애플리케이션 계층 프로토콜의 예이다

UDP가 적합한 애플리케이션은 다음과 같다
- 무슨 데이터를 언제 보낼지에 대해 애플리케이션 레벨에서 더 정교한 제어: `실시간 애플리케이션`은 최소 전송률을 요구할 때도 있고, 지나치게 지연되는 세그먼트 전송을 원하지 않으며, 조금의 데이터 손실은 허용할 수 있다.
- 연결 설정이 없음: 3-way handshake없이 전송한다. 
- 연결 상태가 없음: UDP는 연결 상태를 유지하지 않아 일반적으로 좀 더 많은 액티브 클라이언트를 수용할 수 있다
- 작은 패킷 헤더 오버헤드: UDP는 단지 8바이트의 오버헤드를 갖는다

## 3.3.1 UDP 세그먼트 구조
UDP 헤더는 `2바이트(=16bit)`씩 구성된 단 `4개`의 필드만을 갖는다
- 포트 번호: 목적지 호스트가 목적지 종단 시스템에서 역다중화 기능을 수행하는 정확한 프로세스에게 애플리케이션 데이터를 넘기게 해준다
- 체크섬(checksum): 세그먼트에 오류가 발생했는지를 검사하기 위해 수신 호스트가 사용한다
- 길이: 헤더를 포함하는 UDP 세그먼트의 길이를 나타낸다

---
## 3.3.2 UDP 체크섬
UDP 체크섬은 `오류 검출`을 위한 것이다
즉, 세그먼트가 출발지로부터 목적지로 이동했을 때, UDP 세그먼트 안의 비트에 대한 **변경사항**이 있는지 검사하는 것이다

송신자 측에서 UDP는 세그먼트 안에 있는 모든 16비트 워드의 합산에 대해 다시 `1의 보수`를 수행하며, 합산 과정에서 발생하는 오버플로는 `윤회식 자리올림(wrap around)`의 결과값이 UDP 세그먼트의 체크섬 필드에 삽입된다

수신자 측에서는 체크섬을 포함한 4개의 모든 16비트 워드들이 더해진다. 
- 만약 패킷에 어떤 오류도 없다면, 수신자에서의 합은 `1111111111111111`이 될 것이다.
- 만약 비트 중에 하나라도 0이 있다면, 패킷에 어류가 발생했음을 알 수 있다

UDP가 체크섬을 제공하는 이유는 **출발지와 목적지 사이의 모든 링크가 오류 검사를 제공한다는 보장이 없기 때문이다**

UDP는 **종단 기반으로** 트랜스포트 계층에서 오류 검사를 제공해야만 한다.
이것이 시스템 설계에서 유명한 **종단과 종단의 원칙**의 한 예이다

UDP는 오류 검사를 제공하지만, 오류를 회복하기 위한 어떤 일도 하지 않는다.
손상된 세그먼트를 그냥 버리거나, 경고와 함께 애플리케이션에게 넘겨준다
