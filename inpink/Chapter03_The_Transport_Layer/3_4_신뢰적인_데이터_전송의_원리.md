  > 목차

👉[3.4 신뢰적인 데이터 전송의 원리](#34-신뢰적인-데이터-전송의-원리)　   

  　   　   
　   
## 3.4 신뢰적인 데이터 전송의 원리

신뢰적인 데이터 전송은 전송 계층(4)뿐만 아니라 다른 계층에서도 필요한 부분이다.　   
　   
> 모든 계층에서 신뢰적인 데이터 전송을 할 경우  (rdt 1.0 프로토콜)　   

모든 계층에서 신뢰적으로 데이터를 전송하기 때문에, 오류가 생기지 않는 것이 보장된다. 　   
=> 수신 측에서 송신 측에 "피드백"을 제공할 필요가 없다.　   
　   
하지만 현실은 그렇지 않다. TCP가 신뢰적이라도, 하위계층의 IP는 비신뢰적이다.　   
　   
　   
> 비트 오류가 있는 채널에서의 "신뢰적 데이터 전송" (rdt 2.0 프로토콜)

신뢰적인 전송 계층의 "하위 계층"에서 신뢰적이지 않을 때가 있기 때문에 이와 같은 과정이 필요하다.　   
　   
**긍정 확인응답(ACK)**과 **부정 확인응답(NAK)**이용　   
오류 없이 잘 도착했으면 ACK 필드값을 1으로 한다. NAK 필드값을 0으로 한다.　   
오류가 검출되었으면, ACK 필드값을 0으로 한다. NAK 필드값을 1으로 한다.　   
=> 송신자가 재전송해준다.　   
　   
이 방식은 "전송 후 대기(stop-and-wait)" 방식이다.　   
수신 측에서 송신 측에 "피드백"이 올 때까지 신뢰적으로 전송이 완료된 것이 아니기 때문이다.　   
　   
　   
> **순서 번호**이용 (rdt 2.1 프로토콜)

헤더 중, 순서 번호(sequence number)라는 필드가 있다.　   
신뢰적인 데이터 전송을 위해, 순서대로 도착하는 것이 보장되어야 하기 때문이다.　   
송신자가 데이터 패킷에 순서번호를 순서대로 붙여서 보낸다.　   
　   
순서 번호를 이용하여 다양한 작업을 해줄 수 있다. 자세한 내용은 3.5절 TCP에서 배우게 된다.　   
　   
대표적인 예시를 보자.　   
**송신측에서 수신에 대한 응답**을 받을 때, **가장 최근에 수신된 패킷이, 거기까지는 신뢰적으로 전송되었다는 뜻**이다.　   
이 때, 송신측은 가장 최근에 수신된 패킷의 다음 순서번호를 가진 패킷을 보내주면 된다. 　   
만약 그 패킷이 재전송일 경우, 수신측에서 해당 번호를 보냈다는 것은 어떤 문제(보통 손실)가 발생했다는 것이 된다.　   
　   
=> 순서번호를 이용하면, 부정 확인응답(NAK)을 이용할 필요가 없다! 　   
가장 최근에 수신된 패킷의 '순서 번호'를 이용하기에, NAK을 송신한 것과 **같은 효과**를 가지기 때문이다.　   
　   
　   
> GBN

GBN(Go-Back-N, N부터 반복) 프로토콜은, **확인응답(ACK)를 기다리지 않고 여러 패킷을 전송**한다.　   
**슬라이딩 윈도 프로토콜(sliding-window protocol)** 이라고도 부른다.　   
　   
ACK를 받지 않아도 보낼 수 있는 패킷 수는 최대 N개이다.　   
N을 **윈도 크기(window size)**라고 한다.　   
　   
![image](https://github.com/inpink/CS_Networking_Study/assets/108166692/e13282ce-5a16-4fa8-a0f2-fa723774c6d9)
위 사진을 보자. 　   
파란색 부분은 "이미 응답된(ACK) 부분"　   
하늘색은 "전송했지만 ACK받지 않은 부분"　   
회색은 "전송가능하지만 하지 않은 부분 크기"　   
흰색은 "전송 불가능"　   
이다.　   
　   
여기서 "윈도 크기 N"은 **하늘색+회색** 이다.　   
　   
3.7절 TCP 혼잡 제어에서 자세히 배우지만,　   
1) 수신자가 수신할 수 있고, "버퍼링"할 수 있는 능력　   
2) 현재 네트워크 혼잡 정도　   
에 따라 N은 달라진다.　   
　   
수신자, 네트워크 등에서 위 정보를 받아 송신자는 N을 설정하게 된다.　   
　   
　   
　   
> 신뢰적인 데이터 전송 "용어 정리"

체크섬 : 패킷 안의 "비트 오류 검출"에 사용됨　   
타이머 : 정해진 타이머 시간 내에 전송이 완료되지 않으면, "손실" 또는 "지연"된것으로 판단할 때(타임아웃) 사용함. 무한정 기다릴 수 없기 때문.　   
순서번호 : 위 정리 참고　   
확인응답 : ACK. 패킷이 정확하게 오류 없이 전송되었다는 알림임. 순서 번호를 가지고 있다.　   
부정 확인 응답 : NAK. 일반적으로 정확히 수신되지 않은 패킷의 순서번호를 전달함　   
윈도, 파이프라이닝 : 위 정리 참고　   
