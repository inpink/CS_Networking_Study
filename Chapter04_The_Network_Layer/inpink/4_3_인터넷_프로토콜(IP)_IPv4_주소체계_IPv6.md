> 목차

👉[4.3 인터넷 프로토콜(IP): IPv4, 주소체계, IPv6 등](#43-인터넷-프로토콜ip-ipv4-주소체계-ipv6-등)　   
　   [4.3.1 IPv4 데이터그램 포맷](#431-ipv4-데이터그램-포맷)　   　   
　   [4.3.2 IPv4 주소체계](#432-ipv4-주소체계)　   　       
　   [4.3.3 IPv6](#433-ipv6)　   　       
　   [4.3.4 네트워크 주소 변환(NAT)](#434-네트워크-주소-변환nat)　   　       

　   
　   
　   
## 4.3 인터넷 프로토콜(IP): IPv4, 주소체계, IPv6 등

오늘날의 네트워크에서는 인터넷 프로토콜(IP, Internet Protocol)을 많이 사용한다.
IP 버전에는 IPv4와 IPv6가 대표적인데, 그 중에서도 IPv4를 대부분 사용하고 있다.
이번 장에서는 IP의 주소체계, IPv4, IPv6, Nat에 대해 배워보겠다. 

### 4.3.1 IPv4 데이터그램 포맷

인터넷 네트워크 계층(3)의 패킷을 우리는 **데이터그램**이라고 부른다고 했다.
IPv4 데이터그램의 "포맷(형식)"에 대해 알아보자.


ⓐ 버전 번호
 : 4비트로 되어있다. IP 프로토콜의 version을 뜻한다.
 : 라우터는 버전 번호를 통해 데이터그램의 나머지 부분이 IPv4형식이구나 라는 것을 확인하고 해석한다. IP 버전마다 데이터그램의 포맷이 다르기 때문이다. 
 : IPv4의 데이터그램의 포맷은, 300p 그림 4.17를 참고하자. 
 : 참고로 IPv6의 데이터그램의 포맷은, 315p 그림 4.26을 참고하자.

ⓑ 헤더 길이
 : 4비트로 되어있다. 아래에서 배우겠지만, IPv4 데이터그램은 헤더에 "가변 길이 옵션 헤더"를 포함한다. 따라서, 결정된 헤더의 총 크기를 알려줌으로써 "실제 페이로드(실제 Data)가 시작되는 위치"를 알 수 있다. 
 : 총 헤더 길이는, 위 사진에서 보듯 대체로 20바이트이다. Data부분이 Payload가 된다. Option까지는 다 헤더이다.

 ⓒ 서비스 타입
 : 각기 다른 유형의 IP 데이터그램을 구별한다.
 : 이는 네트워크 관리자가 결정하고 관리하는 정책에 따라 달라질 수 있다. 

 ⓓ 데이터그램 길이
 : 바이트로 계산한 IP 데이터그램(헤더+데이터)의 총 길이이다. 

 ⓔ 식별자, 플래그, 단편화 오프셋
 : 이 3개의 field는 "IP 단편화"와 관련있다. 이는, 큰 크기의 IP 데이터그램이 여러 개의 작은 IP 데이터그램으로 분할되고, 각자 독립적으로 목적지로 전달되어 모이기 때문에 필요하다. 
 : 참고로, IPv6는 단편화를 허용하지 않는다. 그래서 315p를 보면 IPv6의 구조에는 이 3개의 field가 없는 것을 확인할 수 있다.

ⓕ TTL(time-tolive)
 : 이 필드는 네트워크에서 데이터그램이 무한히 순환하지 않도록 한다. 라우팅 루프를 막는다는 것이다. 이 필드값은, 라우터가 데이터그램을 한 번 다룰 때마다 감소한다. TTL 필드값이 0이 되면, 라우터에서 이 데이터그램을 폐기한다.

ⓖ 프로토콜
 : 전달될 목적지의 전송계층(4)의 프로토콜을 명시한다. 
 : 예) UDP, TCP

ⓗ 헤더 체크섬
 : 앞서 배운 것처럼, IP 데이터그램의 "비트 오류"를 탐지할 때 사용한다.
 : 3.3절에서 배운 것처럼, 1의 보수를 이용한다. 

ⓘ 옵션
 : 이 필드를 통해 IP 헤더를 확장할 수 있다. 보통은 이 옵션 필드는 사용되지 않는다.
 : 앞서 우리는 헤더 길이를 통해 페이로드 시작점을 확인할 수 있다고 했다. 하지만 이 옵션 필드가 존재함으로, 옵션에 값이 있을 수도 있기 때문에 초기에 "데이터 필드 시작점"을 지정해주기 어렵다. 
 : IPv6에서는 아예 옵션필드를 허용하지 않는다. 같은 원리로, IPv6에서는 헤더 길이도 40바이트로 고정해주기 때문에 "헤더 길이(ⓑ)"가 필요가 없다.

ⓙ 데이터(페이로드)
 : 전송 계층(4)의 세그먼트(TCP나 UDP)를 담거나, 
 : 네트워크 계층(3)의 인터넷 제어 메시지 프로토콜(ICMP)을 담기도 한다. 
 : ICMP에 대한 내용은 5단원에서 자세히 배운다.

 
### 4.3.2 IPv4 주소체계

인터넷 네트워크 계층(3)에서 가장 중요한 프로토콜인 IPv4이다.

1. IP 주소는 32비트(4바이트)이다.
   : 2^32개 (약 40억 개)의 주소를 사용할 수 있다.

2. 주로 "십진 표기법(dotted-decimal notation)"을 사용한다.
   : 주소의 각 바이트를 10진수로 표현하고, 점(.)으로 구분한다.
   : 예) 193.32.216.9 = 11000001 00100000 11011000 00001001

3. 전 세계 인터넷의 모든 호스트와 라우터들의 

### 4.3.3 IPv6

### 4.3.4 네트워크 주소 변환(NAT)

