> 목차

👉[4.2 라우터 내부에는 무엇이 있을까](#42-라우터-내부에는-무엇이-있을까)　   
　   [4.2.1 입력 포트 처리 및 목적지 기반 전송](#421-입력-포트-처리-및-목적지-기반-전송)　   　   
　   [4.2.2 스위칭](#422-스위칭)　   
　   [4.2.3 출력 포트 처리](#423-출력-포트-처리)　   
　   [4.2.4 어디에서 큐잉이 일어날까?](#424-어디에서-큐잉이-일어날까)　   
 　  [4.2.5 패킷 스케줄링](#425-패킷-스케줄링)　   
      
　   
　   
　   
## 4.2 라우터 내부에는 무엇이 있을까

　   
![image](https://github.com/inpink/CS_Networking_Study/assets/108166692/36f368ad-150c-4562-b8d8-53e8be3faa2c)　   
　   
1. 입력 포트 　   
2. 출력 포트　   
3. 스위치 구조　   
4. 라우팅 프로세서 : 라우팅 프로토콜(5단원) 실행, 포워딩 테이블 계산　   
　   
1,2,3번은 주로 "하드웨어"　   
4번은 "소프트웨어"　   
에서 작동한다.　   
　   
위 그림을 통해 4가지 구성 요소의 구조를 확인하도록 하자.　   
　   
　   
### 4.2.2 스위칭

ⓐ "메모리"를 통한 교환 　   
ⓑ "버스"를 통한 교환　   
ⓒ "상호연결 네트워크"를 통한 교환　   　   
　   
=> 말 그대로, "입력 포트"에서 "출력 포트"로 실제로 **스위칭(포워딩)** 될 때, 　   
"메모리"를 통할 것인지, "공유 버스"를 통할 것인지, "여러 개의 버스로 구성된 상호 연결된 네트워크"를 통할 것인지의 차이이다.　   
　   
　   
### 4.2.4 어디에서 큐잉이 일어날까?

> 입력 큐잉

입력 포트에서 발생하는 큐잉 지연을 뜻한다.　   　   
입력 포트에 전송하는 모든 패킷을 지연 없이 출력 포트로 전달하려면, 　   
"입력 라인 속도"보다 "입력 포트-> 출력 포트 속도"가 N배 이상 빨라야 한다. 　   
　   
291p의 그림 4.8을 보면 이해가 더 잘 된다. 　   
여러 개의 입력 포트와 여러 개의 출력 포트가 있다.　   
여러 개의 입력 포트에서 하나의 출력 포트로 가려고 한다.　   
근데, 이 때 모든 링크의 전송 속도가 같다면? 　   
하나의 출력 포트는 하나의 패킷을 받을 수 있기 때문에, 입력 포트에서 큐잉 지연이 발생하게 된다.　   
　   
하지만 "입력 포트-> 출력 포트 속도"가 N배 이상 빠르면,　   
어떠한 최악의 경우에도, 모든 N개의 입력 라인이 패킷들을 수신하고, 이 모든 N개의가 하나의 "출력 포트"로 전달된다고 해도, 　   
시간 간격이 0이 되며 지연이 없이 전달될 수 있다.　   
　   
> 출력 큐잉

스위치의 출력 포트에서 발생하는 큐잉 지연을 뜻한다.　   
위의 입력 큐잉과 비슷하다. "출력 포트에 들어오는 속도"와 "출력 포트에서 내보내는 속도"의 차이 때문에 출력 큐잉이 발생한다.　   
이 때, 출력 포트를 통해 다른 라우터나 호스트에게 패킷을 전송해줘야 하는데,　   
출력 포트에 쌓인 패킷 중, 어떤 것을 먼저 내보내야 할지를 **패킷 스케쥴링**을 통해 결정해주게 된다.　   
패킷 스케쥴링의 다양한 알고리즘은 바로 아래에서 학습해보자.　   
　   
　   
### 4.2.5 패킷 스케줄링　   

ⓐ FIFO(First In First Out)　   
 : 선입선출. FCFS라고도 한다. 먼저 도착한 패킷이 먼저 나간다.　   
 　   
ⓑ 우선순위 큐잉　   
 : 출력 링크에 패킷이 도착하면, **우선순위 클래스**로 분류된다. 　   
 : 우선순위가 동일한 패킷들 중의 선택은, 전형적으로 FIFO를 많이 사용한다.　   
 : 296p 그림 4.14를 참고하자. 　   
 　   
ⓒ 라운드로빈, WFQ(Weighted Fair Queueing)　   
 : 우선순위 큐잉에서 여러 개의 큐를 사용했던 것처럼, 라운드 로빈에서는 여러 "클래스"에 패킷을 분류한다.　   
 : 우선순위 큐잉처럼 우선순위가 존재하지 않고, 라운드 로빈 스케쥴가 클래스간의 서비스를 번갈아서 제공한다.　   
 : 가장 단순한 라운드 로빈 스케쥴링에서는 "클래스 1-> 클래스 2-> 클래스 1"이런 식으로 번갈아가며 각 클래스당 **같은 시간동안** 패킷을 전송해준다.　   
 : 라우터에서 널리 사용되는 WFQ는, 라운드 로빈 큐잉의 일반화된 형태이다. 라운드 로빈 큐잉과의 차이점은, "각 클래스마다 다른 양의 시간을 할당받는다"는 것이다. 　   
 : (라운드 로빈은 각 클래스당 번갈아가며 같은 시간동안 할당했다. 하나의 패킷을 다 전송하지 못하더라도, 시간 할당량이 끝나면 다른 클래스로 넘어간다.)　   
